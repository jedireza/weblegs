<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title>Weblegs Framework</title>
        <link href="assets/css/bootstrap.css" rel="stylesheet">
        <link href="assets/css/bootstrap-responsive.css" rel="stylesheet">
        <link href="assets/css/docs.css" rel="stylesheet">
        <link href="assets/js/google-code-prettify/prettify.css" rel="stylesheet">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
    </head>
    <body>
        <div class="navbar navbar-fixed-top">
            <div class="navbar-inner">
                <div class="container">
                    <button type="button" class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                       <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                    <a class="brand" href="./index.html">Weblegs</a>
                    <div class="nav-collapse collapse">
                        <ul class="nav">
                            <li class="active"><a href="./index.html">Overview</a></li>
                            <li><a href="#tour" rel="tooltip" data-placement="bottom" data-original-title="coming soon">Feature Tour</a></li>
                            <li><a href="#libs" rel="tooltip" data-placement="bottom" data-original-title="coming soon">Library Docs</a></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="jumbotron masthead">
            <div class="container">
                <h1>Weblegs<span class="reg">&#174;</span></h1>
                <p>Simple and flexible web apps using tried and true technologies. Enhanced with with <a href="http://twitter.github.com/bootstrap/">Bootstrap</a>.</p>
                <p class="download-info">
                    <a href="https://github.com/weblegs/framework/" class="btn btn-inverse btn-large">View project on GitHub</a>
                    <a href="https://github.com/weblegs/framework/zipball/master" class="btn btn-primary btn-large">Download Weblegs <small>(v3.5.0)</small></a>
                </p>
            </div>
        </div>
        
        <div class="container">
            <div class="marketing">
                <h1>For small business and startups.</h1>
                <p class="marketing-byline">Weblegs get's things moving quickly and has what you need.</p>
                
                <div class="row-fluid">
                    <ul class="thumbnails example-sites">
                        <li class="span3">
                            <a class="thumbnail">
                                <img src="assets/img/screen-shots/home.png" alt="Home">
                            </a>
                        </li>
                        <li class="span3">
                            <a class="thumbnail">
                                <img src="assets/img/screen-shots/contact.png" alt="Contact">
                            </a>
                        </li>
                        <li class="span3">
                            <a class="thumbnail">
                                <img src="assets/img/screen-shots/login.png" alt="Login">
                            </a>
                        </li>
                        <li class="span3">
                            <a class="thumbnail">
                                <img src="assets/img/screen-shots/admin.png" alt="Admin">
                            </a>
                        </li>
                    </ul>
                </div>
                
                <div class="row">
                    <div class="span4">
                        <h2>Frontend Website</h2>
                        <p>Just the basics: home, about, contact and login. Add and remove pages as needed.</p>
                    </div>
                    <div class="span4">
                        <h2>User System</h2>
                        <p>Login system and reset password built in. There is also groups and permissions.</p>
                    </div>
                    <div class="span4">
                        <h2>Backend Admin</h2>
                        <p>Setup with the basics and ready to be extended. Don't be shy, check it out.</p>
                    </div>
                </div><!--/row-->
                
                <hr class="soften">
                
                <h1>You already know this stuff.</h1>
                <p class="marketing-byline">Apache • PHP • MySQL • HTML • CSS • JS • XSLT</p>
            </div>
            
            <section id="file-structure">
                <div class="page-header">
                    <h1>File Structure &amp; Installation</h1>
                </div>
                <p class="lead">Here is a summary view of the project files.</p>
<pre class="prettyprint">
project/
    ├── app/
    │   ├── lib/...
    │   ├── config.php
    ├── cli/
    │   ├── test/...
    │   ├── run
    ├── lib/
    │   ├── footprint/...
    │   ├── weblegs/...
    ├── www/
    │   ├── ...
    │   ├── .controller.php
    │   ├── .htaccess
    │   ├── .route.php
    │   ├── index.html
    │   ├── favicon.ico
    │   ├── ...
    ├── www-cache/...
    ├── mysql-db-structure.sql
    └── README.md
</pre>
                <h4>Installation:</h4>
                <ol>
                    <li>Download and unzip files (or git clone) into a directory of your choice.</li>
                    <li>Create new mysql database and import the <code>mysql-db-structure.sql</code> file.</li>
                    <li>Configure project settings via the <code>app/config.php</code> file. Make sure you supply MySQL credentials.</li>
                    <li>Supply SMTP credentials if you want emails to send.</li>
                    <li>Tell Apache to serve files from <code>www/</code>.</li>
                </ol>
                <h4>Gotchas:</h4>
                <ul>
                    <li>You'll need PHP's <code>libxsl</code> module installed. We use version 1.1.26 compiled against <code>libxml</code> version 2.7.8.</li>
                    <li>Don't install as directory under another domain, setup your project as it's own domain.</li>
                    <li>The default root user's password is <code>root</code>. You should change that after install.</li>
                </ul>
            </section>
            
            <section id="execution-mode">
                <div class="page-header">
                    <h1>Execution Engine</h1>
                </div>
                <p class="lead">Weblegs apps can run in either <code>www</code> or <code>cli</code> mode. Web requests start at Apache and the cli scripts are executed on the command line (i.e.: cron jobs).</p>
                <p class="lead">Both modes use the same config file and in either mode you have access to the Footprint Engine (<code>lib/footprint/Engine.php</code>). You can access this static object in any PHP scripts using the shorthand symbold <code>F</code>.</p>
<pre class="prettyprint">
//set some config data (in either mode)
F::$config->set("user_id", 840);

//get some config data (in either mode)
F::$config->get("user_id");
</pre>
                <p class="lead">Both modes follow an event-style execution. You create classes with methods that the engine executes at the appropriate time.</p>
                <p>You create a <code>Task</code> class in <code>cli</code> scripts. Kinda looks like:</p>
<pre class="prettyprint">
class Task {
    /**
     * handles the on load event
     */
    public static function eventOnLoad() {
        $args = print_r(F::$engineArgs, true);
        print($args);
    }
}
</pre>
                <p>You create a <code>Page</code> class in <code>www</code> scripts. Kinda looks like:</p>
<pre class="prettyprint">
class Page {
    /**
     * sends the submitted message
     */
    public static function actionSendMessage() {
        //validate
        if(F::$request->input("name") == "") {
            F::$errors->add("name", "required");
        }
        
        //take action
        if(F::$errors->count() == 0) {
            //send email
            F::$emailClient->addTo(F::$config->get("admin-email"));
            F::$emailClient->subject = "Contact Form Submission";
            F::$emailClient->message = "An awesome email message from: ". F::$request->input("name") .".";
            F::$emailClient->send();
        }
    }
}
</pre>
            </section>
            
            <section id="cli-mode">
                <div class="page-header">
                    <h1>CLI Mode &amp; Events</h1>
                </div>
                <p class="lead">You execute <code>cli</code> scripts on the command line through the <code>cli/run</code> bash script. For example:</p>
<pre class="prettyprint">
//go to your project cli directory
# cd /myproject/cli

//run a script
# ./run import-feed/index.php 
</pre>
                <p class="lead">The <code>cli/run</code> bash script is super basic. As you can see all we're doing is routing the task script's path to our <code>cli/.controller.php</code> script as an argument.</p>
<pre class="prettyprint">
#!/bin/bash
php .controller.php $@
</pre>
                <p class="lead">In <code>cli/.controller.php</code> we include the config first, then your task script and finally start the engine:</p>
<pre class="prettyprint">
&lt;?php

require_once(dirname(__FILE__) ."/../app/config.php");
require_once(dirname(__FILE__) ."/../cli/". $argv[1]);

/**
 * start the engine
 */
F::init();
</pre>
                <p class="lead">From here the engine begins processing. Here is a summary of what happens in <code>cli</code> mode:</p>
                <ul>
                    <li>Setup engine object, init stuff and open db</li>
                    <li>Determine path namespace (kinda like a signature of execution)</li>
                    <li>Fire <code>Task::eventOnLoad</code> method</li>
                    <li>Loads namespace HTML file into <code>F::$doc</code> (if used)</li>
                    <li>Fire <code>Task::eventBeforeFinalize</code> method</li>
                    <li>Final processing of HTML binding instructions</li>
                    <li>Fire <code>Task::eventFinal</code> method</li>
                    <li>Close db and finish execution</li>
                </ul>
                <p>There's not much going on in <code>cli</code> mode compared to what <code>www</code> mode has going on, so we'll leave it at that.</p>
            </section>
            
            <section id="web-mode">
                <div class="page-header">
                    <h1>WWW Mode &amp; Events</h1>
                </div>
                <p class="lead">Your <code>www</code> scripts get executed during web requests (*cough* Apache *cough*) so the first layer in the process starts with the <code>www/.htaccess</code> file.</p>
<pre class="prettyprint">
&lt;FilesMatch "(.xsl|.sql.xml|.php|.email.html)$"&gt;
    Order Allow,Deny
    Deny from all
&lt;/FilesMatch&gt;
&lt;Files ".controller.php"&gt;
    Allow from all
&lt;/Files&gt;

RewriteEngine On
RewriteBase /

RewriteCond %{REQUEST_URI} !\.(php|zip|csv|css|txt|xml|js|gif|png|swf|ico|jpe?g)$
RewriteRule (.*)$ /.controller.php [L]
</pre>
                <p class="lead">First we deny access to any senstive files we don't want exposed to web clients. Then we route stuff like media and data files normally through Apache. Any other requests get routed through the <code>www/.controller.php</code> file.</p>
<pre class="prettyprint">
&lt;?php

require_once(dirname(__FILE__) ."/../app/config.php");
require_once(dirname(__FILE__) ."/../lib/footprint/Router.php");

/**
 * first check the cache
 */
Router::cacheCheck();

/**
 * initialize the router
 */
Router::init();
</pre>
                <p class="lead">So instead of just staring the engine, like a <code>cli</code> script, first we initalize the Footprint Router <code>lib/footprint/Router.php</code>, which in turn starts the engine (after some other stuff). The <code>Router</code> object helps us rewrite URLs and will serve cached files when appropriate. If cache is served, no resources are ever opened and the request is finished.</p>
                <p class="lead">URL rewrites are handled with PHP. You control rewriting with <code>.route.php</code> files. These work like <code>.htacess</code> files where the closest file wins.</p>
                <p class="lead">Generally here is what the router does:</p>
                <ul>
                    <li>Seperates the querystring from the request path</li>
                    <li>Finds the closest <code>.route.php</code> file and loads contents</li>
                    <li>Fires the <code>Route::eventOnLoad</code> method</li>
                    <li>Starts the engine</li>
                </ul>
                <p class="lead">From here the engine begins processing. Here is a summary of what happens in <code>www</code> mode:</p>
                <ul>
                    <li>Setup engine object and init stuff</li>
                    <li>Determine path namespace (kinda like a signature of execution)</li>
                    <li>Includes source of any <code>helpers.php</code> files peer to the namespace path</li>
                    <li>Includes PHP source of the namespace if it exists</li>
                    <li>Fire <code>Page::eventOnLoad</code> method</li>
                    <li>Loads namespace HTML file into <code>F::$doc</code> and processes meta instructions</li>
                    <li>Open up the db</li>
                    <li>Fire <code>Page::eventBeforeActions</code> method</li>
                    <li>Fire <code>action</code> method</li>
                    <li>Fire <code>Page::eventBeforeBinding</code> method</li>
                    <li>Executes DOM instructions and data bindings</li>
                    <li>Fire <code>Page::eventBeforeFinalize</code> method</li>
                    <li>Special case JSON/Ajax request handling</li>
                    <li>Final processing of HTML binding instructions</li>
                    <li>Fire <code>Page::eventBeforeOutputGeneration</code> method</li>
                    <li>Generates final output</li>
                    <li>Fire <code>Page::eventFinal</code> method</li>
                    <li>Close db, store cached result (when appropriate) and finish execution</li>
                </ul>
            </section>
            
            <section id="web-mode">
                <div class="page-header">
                    <h1>Engine Namespace</h1>
                </div>
                <p class="lead">The engine namespace (<code>F::$engineNamespace</code>) property is like a path signature. For example, the engine namespace of <code>http://myproject/login/index.html</code> is <code>login/index</code>. It's the path without a file extension. This allows us to do some helpful things like auto include PHP/HTML/JS/CSS respectfully.</p>
                <p class="lead">Take our home page for example (<code>www/index.html</code>). If we simply added the files <code>www/index.css</code> and/or <code>www/index.js</code> the engine will add the appropriate CSS or JS include tags into the document DOM before sending it to the client.</p>
<pre class="prettyprint">
&lt;!DOCTYPE html&gt;
&lt;html&gt;
    &lt;head&gt;
        &lt;title&gt;Home Page&lt;/title&gt;
    &lt;/head&gt;
    &lt;body&gt;
        ...
    &lt;/body&gt;
&lt;/html&gt;
</pre>
                <p>Would automatically become:</p>
<pre class="prettyprint">
&lt;!DOCTYPE html&gt;
&lt;html&gt;
    &lt;head&gt;
        &lt;title&gt;Home Page&lt;/title&gt;
        &lt;link href="index.css" rel="stylesheet" type="text/css"&gt;
        &lt;script language="javascript" src="index.js" type="text/javascript"&gt;&lt;/script&gt;
    &lt;/head&gt;
    &lt;body&gt;
        ...
    &lt;/body&gt;
&lt;/html&gt;
</pre>
                <p>You could obviously name your files something unique like <code>www/cool.css</code> and include the markup yourself manually. But it's nice to keep the set of files as a named unit. The other advantage to the engine auto-includes is that you can also tell the engine to add unique query params like <code>index.css?nocache=50392f1aa2ef2</code>. This will force web clients to download the latest versions.</p>
            </section>
        </div>
        
        <footer class="footer">
            <div class="container">
                <div class="pull-right">
                    
                    <p>Yes, we borrowed Bootstrap's <code>doc.css</code> file. It's sexy.</p>
                </div>
                <p>Made with blood, sweat and love by Reza and Sam.</p>
                <p>Built to be shared.</p>
                <ul class="footer-links">
                    <li><a href="https://github.com/weblegs/framework/issues?state=open">Submit issues</a></li>
                    <li><a href="#">Back to top</a></li>
                </ul>
            </div>
        </footer>
        
        <script src="assets/js/jquery.js"></script>
        <script src="assets/js/google-code-prettify/prettify.js"></script>
        <script src="assets/js/bootstrap.min.js"></script>
        <script src="assets/js/bootstrap-tooltip.js"></script>
        <script src="index.js"></script>
    </body>
</html>